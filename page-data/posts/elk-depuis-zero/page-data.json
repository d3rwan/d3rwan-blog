{"componentChunkName":"component---src-templates-post-template-js","path":"/posts/elk-depuis-zero","result":{"data":{"markdownRemark":{"id":"e0e7832e-aef5-5c88-a352-464dafbd4655","html":"<p>Ou comment déployer une architecture de monitoring en quelques minutes.</p>\n<h2 id=\"mo-ni-to-rer\" style=\"position:relative;\"><a href=\"#mo-ni-to-rer\" aria-label=\"mo ni to rer permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><strong><em>Mo-ni-to-rer.</em></strong></h2>\n<p>En quelques années, le monitoring est devenu une activité indispensable dans le monde de l’IT. Qu’il soit technique ou fonctionnel, qu’il fournisse des métriques, charts, ou autres KPI, le monitoring de son système est devenu un must-have.</p>\n<p>Dans la suite de l’article, nous allons voir comment déployer une architecture de monitoring à partir de zéro, en quelques minutes, grâce à Docker.</p>\n<h2 id=\"la-stack\" style=\"position:relative;\"><a href=\"#la-stack\" aria-label=\"la stack permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>La stack.</h2>\n<p>Pour commencer, nous nous appuyerons sur la stack <strong><em>ELK</em></strong> qui, en quelques années, est devenue une alternative crédible aux autres solutions de monitoring (Splunk, solutions SAAS…).</p>\n<p>Elle se compose des éléments suivants:</p>\n<ul>\n<li><strong>E</strong> comme <em>Elasticsearch</em>, le moteur d’indexation, de recherche &#x26; d’analytics,</li>\n<li><strong>L</strong> comme <em>Logstash</em>, un ETL permettant de récupérer les données dans des sources hétérogènes, les transformer et les envoyer vers Elasticsearch,</li>\n<li><strong>K</strong> comme <em>Kibana</em>, un IHM de visualisation et de générations de tableaux de bord interactifs</li>\n</ul>\n<p>Nous ajouterons également :</p>\n<ul>\n<li><strong>R</strong> comme *Redis, *utilisé comme broker en amont, qui servira de buffer en cas de latence du système, tout en évitant un engorgement trop important en cas de pic,</li>\n<li><strong>C</strong> comme <em>Curator</em>, un outil de management des indexs</li>\n<li>**B *<em>comme *Beats</em>, sondes à installer côté client afin d’envoyer les logs/métriques à notre stack</li>\n</ul>\n<p><img src=\"/d3rwan-blog/media/elk/stack-elk.jpeg\" alt=\"Stack de monitoring\"><em>Notre stack de monitoring</em></p>\n<h2 id=\"déploiement\" style=\"position:relative;\"><a href=\"#d%C3%A9ploiement\" aria-label=\"déploiement permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><strong><em>Déploiement.</em></strong></h2>\n<p>Nous utiliserons des conteneurs Docker pour chacun des composants de notre stack.</p>\n<ul>\n<li><a href=\"https://hub.docker.com/_/elasticsearch/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Elasticsearch</a>, dans sa version 5.1.2,</li>\n<li><a href=\"https://hub.docker.com/_/logstash/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Logstash</a>, dans sa version 5.1.2,</li>\n<li><a href=\"https://hub.docker.com/_/kibana/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Kibana</a>, dans sa version 5.1.2,</li>\n<li><a href=\"https://hub.docker.com/_/redis/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Redis</a>, dans sa version 3.2.6,</li>\n<li><a href=\"https://hub.docker.com/r/bobrik/curator/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Curator</a>, dans sa version 4.0.4</li>\n</ul>\n<p>L’ensemble des services et des interactions sont décrites dans un fichier docker-compose.yml:</p>\n<p><div id=\"gist40308415\" class=\"gist\">\n    <div class=\"gist-file\">\n      <div class=\"gist-data\">\n        <div class=\"js-gist-file-update-container js-task-list-container file-box\">\n  <div id=\"file-docker-compose-yml\" class=\"file\">\n    \n\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper data type-yaml \">\n      \n<table class=\"highlight tab-size js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip>\n      <tr>\n        <td id=\"file-docker-compose-yml-L1\" class=\"blob-num js-line-number\" data-line-number=\"1\"></td>\n        <td id=\"file-docker-compose-yml-LC1\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-ent\">version</span>: <span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>2<span class=\"pl-pds\">&quot;</span></span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L2\" class=\"blob-num js-line-number\" data-line-number=\"2\"></td>\n        <td id=\"file-docker-compose-yml-LC2\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L3\" class=\"blob-num js-line-number\" data-line-number=\"3\"></td>\n        <td id=\"file-docker-compose-yml-LC3\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-ent\">services</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L4\" class=\"blob-num js-line-number\" data-line-number=\"4\"></td>\n        <td id=\"file-docker-compose-yml-LC4\" class=\"blob-code blob-code-inner js-file-line\">  <span class=\"pl-c\"><span class=\"pl-c\">#</span> brocker</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L5\" class=\"blob-num js-line-number\" data-line-number=\"5\"></td>\n        <td id=\"file-docker-compose-yml-LC5\" class=\"blob-code blob-code-inner js-file-line\">  <span class=\"pl-ent\">redis</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L6\" class=\"blob-num js-line-number\" data-line-number=\"6\"></td>\n        <td id=\"file-docker-compose-yml-LC6\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">image</span>: <span class=\"pl-s\">redis:3.2.6</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L7\" class=\"blob-num js-line-number\" data-line-number=\"7\"></td>\n        <td id=\"file-docker-compose-yml-LC7\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">container_name</span>: <span class=\"pl-s\">redis</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L8\" class=\"blob-num js-line-number\" data-line-number=\"8\"></td>\n        <td id=\"file-docker-compose-yml-LC8\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">ports</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L9\" class=\"blob-num js-line-number\" data-line-number=\"9\"></td>\n        <td id=\"file-docker-compose-yml-LC9\" class=\"blob-code blob-code-inner js-file-line\">      - <span class=\"pl-c1\">6379:6379</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L10\" class=\"blob-num js-line-number\" data-line-number=\"10\"></td>\n        <td id=\"file-docker-compose-yml-LC10\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">volumes</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L11\" class=\"blob-num js-line-number\" data-line-number=\"11\"></td>\n        <td id=\"file-docker-compose-yml-LC11\" class=\"blob-code blob-code-inner js-file-line\">      - <span class=\"pl-s\">redis-data:/data</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L12\" class=\"blob-num js-line-number\" data-line-number=\"12\"></td>\n        <td id=\"file-docker-compose-yml-LC12\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">networks</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L13\" class=\"blob-num js-line-number\" data-line-number=\"13\"></td>\n        <td id=\"file-docker-compose-yml-LC13\" class=\"blob-code blob-code-inner js-file-line\">      - <span class=\"pl-s\">logging</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L14\" class=\"blob-num js-line-number\" data-line-number=\"14\"></td>\n        <td id=\"file-docker-compose-yml-LC14\" class=\"blob-code blob-code-inner js-file-line\">  <span class=\"pl-c\"><span class=\"pl-c\">#</span> index, search &amp; agregation</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L15\" class=\"blob-num js-line-number\" data-line-number=\"15\"></td>\n        <td id=\"file-docker-compose-yml-LC15\" class=\"blob-code blob-code-inner js-file-line\">  <span class=\"pl-ent\">elasticsearch</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L16\" class=\"blob-num js-line-number\" data-line-number=\"16\"></td>\n        <td id=\"file-docker-compose-yml-LC16\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">image</span>: <span class=\"pl-s\">elasticsearch:5.1.2</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L17\" class=\"blob-num js-line-number\" data-line-number=\"17\"></td>\n        <td id=\"file-docker-compose-yml-LC17\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">container_name</span>: <span class=\"pl-s\">elastic</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L18\" class=\"blob-num js-line-number\" data-line-number=\"18\"></td>\n        <td id=\"file-docker-compose-yml-LC18\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">environment</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L19\" class=\"blob-num js-line-number\" data-line-number=\"19\"></td>\n        <td id=\"file-docker-compose-yml-LC19\" class=\"blob-code blob-code-inner js-file-line\">      - <span class=\"pl-s\">ES_JAVA_OPTS=-Xms1g -Xmx1g</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L20\" class=\"blob-num js-line-number\" data-line-number=\"20\"></td>\n        <td id=\"file-docker-compose-yml-LC20\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">ports</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L21\" class=\"blob-num js-line-number\" data-line-number=\"21\"></td>\n        <td id=\"file-docker-compose-yml-LC21\" class=\"blob-code blob-code-inner js-file-line\">      - <span class=\"pl-c1\">9200:9200</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L22\" class=\"blob-num js-line-number\" data-line-number=\"22\"></td>\n        <td id=\"file-docker-compose-yml-LC22\" class=\"blob-code blob-code-inner js-file-line\">      - <span class=\"pl-c1\">9300:9300</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L23\" class=\"blob-num js-line-number\" data-line-number=\"23\"></td>\n        <td id=\"file-docker-compose-yml-LC23\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">volumes</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L24\" class=\"blob-num js-line-number\" data-line-number=\"24\"></td>\n        <td id=\"file-docker-compose-yml-LC24\" class=\"blob-code blob-code-inner js-file-line\">      - <span class=\"pl-s\">$PWD/elasticsearch/config/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L25\" class=\"blob-num js-line-number\" data-line-number=\"25\"></td>\n        <td id=\"file-docker-compose-yml-LC25\" class=\"blob-code blob-code-inner js-file-line\">      - <span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>es-data:/usr/share/elasticsearch/data<span class=\"pl-pds\">&quot;</span></span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L26\" class=\"blob-num js-line-number\" data-line-number=\"26\"></td>\n        <td id=\"file-docker-compose-yml-LC26\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">networks</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L27\" class=\"blob-num js-line-number\" data-line-number=\"27\"></td>\n        <td id=\"file-docker-compose-yml-LC27\" class=\"blob-code blob-code-inner js-file-line\">      - <span class=\"pl-s\">logging</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L28\" class=\"blob-num js-line-number\" data-line-number=\"28\"></td>\n        <td id=\"file-docker-compose-yml-LC28\" class=\"blob-code blob-code-inner js-file-line\">  <span class=\"pl-c\"><span class=\"pl-c\">#</span> UI</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L29\" class=\"blob-num js-line-number\" data-line-number=\"29\"></td>\n        <td id=\"file-docker-compose-yml-LC29\" class=\"blob-code blob-code-inner js-file-line\">  <span class=\"pl-ent\">kibana</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L30\" class=\"blob-num js-line-number\" data-line-number=\"30\"></td>\n        <td id=\"file-docker-compose-yml-LC30\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">image</span>: <span class=\"pl-s\">kibana:5.1.2</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L31\" class=\"blob-num js-line-number\" data-line-number=\"31\"></td>\n        <td id=\"file-docker-compose-yml-LC31\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">container_name</span>: <span class=\"pl-s\">kibana</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L32\" class=\"blob-num js-line-number\" data-line-number=\"32\"></td>\n        <td id=\"file-docker-compose-yml-LC32\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">ports</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L33\" class=\"blob-num js-line-number\" data-line-number=\"33\"></td>\n        <td id=\"file-docker-compose-yml-LC33\" class=\"blob-code blob-code-inner js-file-line\">      - <span class=\"pl-c1\">5601:5601</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L34\" class=\"blob-num js-line-number\" data-line-number=\"34\"></td>\n        <td id=\"file-docker-compose-yml-LC34\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">volumes</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L35\" class=\"blob-num js-line-number\" data-line-number=\"35\"></td>\n        <td id=\"file-docker-compose-yml-LC35\" class=\"blob-code blob-code-inner js-file-line\">      - <span class=\"pl-s\">$PWD/kibana/config/kibana.yml:/etc/kibana/kibana.yml</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L36\" class=\"blob-num js-line-number\" data-line-number=\"36\"></td>\n        <td id=\"file-docker-compose-yml-LC36\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">networks</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L37\" class=\"blob-num js-line-number\" data-line-number=\"37\"></td>\n        <td id=\"file-docker-compose-yml-LC37\" class=\"blob-code blob-code-inner js-file-line\">      - <span class=\"pl-s\">logging</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L38\" class=\"blob-num js-line-number\" data-line-number=\"38\"></td>\n        <td id=\"file-docker-compose-yml-LC38\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">depends_on</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L39\" class=\"blob-num js-line-number\" data-line-number=\"39\"></td>\n        <td id=\"file-docker-compose-yml-LC39\" class=\"blob-code blob-code-inner js-file-line\">      - <span class=\"pl-s\">elasticsearch</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L40\" class=\"blob-num js-line-number\" data-line-number=\"40\"></td>\n        <td id=\"file-docker-compose-yml-LC40\" class=\"blob-code blob-code-inner js-file-line\">  <span class=\"pl-c\"><span class=\"pl-c\">#</span> indexer</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L41\" class=\"blob-num js-line-number\" data-line-number=\"41\"></td>\n        <td id=\"file-docker-compose-yml-LC41\" class=\"blob-code blob-code-inner js-file-line\">  <span class=\"pl-ent\">logstash</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L42\" class=\"blob-num js-line-number\" data-line-number=\"42\"></td>\n        <td id=\"file-docker-compose-yml-LC42\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">image</span>: <span class=\"pl-s\">logstash:5.1.2</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L43\" class=\"blob-num js-line-number\" data-line-number=\"43\"></td>\n        <td id=\"file-docker-compose-yml-LC43\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">container_name</span>: <span class=\"pl-s\">logstash</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L44\" class=\"blob-num js-line-number\" data-line-number=\"44\"></td>\n        <td id=\"file-docker-compose-yml-LC44\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">command</span>: <span class=\"pl-s\">logstash -f /config/</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L45\" class=\"blob-num js-line-number\" data-line-number=\"45\"></td>\n        <td id=\"file-docker-compose-yml-LC45\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">environment</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L46\" class=\"blob-num js-line-number\" data-line-number=\"46\"></td>\n        <td id=\"file-docker-compose-yml-LC46\" class=\"blob-code blob-code-inner js-file-line\">      - <span class=\"pl-s\">JAVA_OPTS=-Xms1g -Xmx1g</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L47\" class=\"blob-num js-line-number\" data-line-number=\"47\"></td>\n        <td id=\"file-docker-compose-yml-LC47\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">volumes</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L48\" class=\"blob-num js-line-number\" data-line-number=\"48\"></td>\n        <td id=\"file-docker-compose-yml-LC48\" class=\"blob-code blob-code-inner js-file-line\">      - <span class=\"pl-s\">$PWD/logstash/config:/config</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L49\" class=\"blob-num js-line-number\" data-line-number=\"49\"></td>\n        <td id=\"file-docker-compose-yml-LC49\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">networks</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L50\" class=\"blob-num js-line-number\" data-line-number=\"50\"></td>\n        <td id=\"file-docker-compose-yml-LC50\" class=\"blob-code blob-code-inner js-file-line\">      - <span class=\"pl-s\">logging</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L51\" class=\"blob-num js-line-number\" data-line-number=\"51\"></td>\n        <td id=\"file-docker-compose-yml-LC51\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">depends_on</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L52\" class=\"blob-num js-line-number\" data-line-number=\"52\"></td>\n        <td id=\"file-docker-compose-yml-LC52\" class=\"blob-code blob-code-inner js-file-line\">      - <span class=\"pl-s\">elasticsearch</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L53\" class=\"blob-num js-line-number\" data-line-number=\"53\"></td>\n        <td id=\"file-docker-compose-yml-LC53\" class=\"blob-code blob-code-inner js-file-line\">      - <span class=\"pl-s\">redis</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L54\" class=\"blob-num js-line-number\" data-line-number=\"54\"></td>\n        <td id=\"file-docker-compose-yml-LC54\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L55\" class=\"blob-num js-line-number\" data-line-number=\"55\"></td>\n        <td id=\"file-docker-compose-yml-LC55\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-ent\">volumes</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L56\" class=\"blob-num js-line-number\" data-line-number=\"56\"></td>\n        <td id=\"file-docker-compose-yml-LC56\" class=\"blob-code blob-code-inner js-file-line\">  <span class=\"pl-ent\">es-data</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L57\" class=\"blob-num js-line-number\" data-line-number=\"57\"></td>\n        <td id=\"file-docker-compose-yml-LC57\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">driver</span>: <span class=\"pl-s\">local</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L58\" class=\"blob-num js-line-number\" data-line-number=\"58\"></td>\n        <td id=\"file-docker-compose-yml-LC58\" class=\"blob-code blob-code-inner js-file-line\">  <span class=\"pl-ent\">redis-data</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L59\" class=\"blob-num js-line-number\" data-line-number=\"59\"></td>\n        <td id=\"file-docker-compose-yml-LC59\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">driver</span>: <span class=\"pl-s\">local</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L60\" class=\"blob-num js-line-number\" data-line-number=\"60\"></td>\n        <td id=\"file-docker-compose-yml-LC60\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L61\" class=\"blob-num js-line-number\" data-line-number=\"61\"></td>\n        <td id=\"file-docker-compose-yml-LC61\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-ent\">networks</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L62\" class=\"blob-num js-line-number\" data-line-number=\"62\"></td>\n        <td id=\"file-docker-compose-yml-LC62\" class=\"blob-code blob-code-inner js-file-line\">  <span class=\"pl-ent\">logging</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L63\" class=\"blob-num js-line-number\" data-line-number=\"63\"></td>\n        <td id=\"file-docker-compose-yml-LC63\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">driver</span>: <span class=\"pl-s\">bridge</span></td>\n      </tr>\n</table>\n\n\n  </div>\n\n  </div>\n</div>\n\n      </div>\n      <div class=\"gist-meta\">\n        <a href=\"https://gist.github.com/d3rwan/66311cf71c8398aae0be32e47f270bab/raw/82a27cb75de0e72f2f67e1a2d72a94d7b7317678/docker-compose.yml\" style=\"float:right\">view raw</a>\n        <a href=\"https://gist.github.com/d3rwan/66311cf71c8398aae0be32e47f270bab#file-docker-compose-yml\">docker-compose.yml</a>\n        hosted with &#10084; by <a href=\"https://github.com\">GitHub</a>\n      </div>\n    </div>\n</div></p>\n<p>Pour chacun des services, on va définir si besoin les ports à exposer ou les volumes à utiliser (notamment les fichiers de configuration). Un exemple de configuration viable est disponible sur mon compte github : <a href=\"https://github.com/d3rwan/docker_elk_stack\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">docker_elk_stack</a>.</p>\n<h2 id=\"hello-world\" style=\"position:relative;\"><a href=\"#hello-world\" aria-label=\"hello world permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Hello, world</h2>\n<p>En se basant sur ce repository, nous allons déployer une stack fonctionnelle:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># clone repo &amp; build images\ngit clone [https://github.com/d3rwan/docker_elk_stack](https://github.com/d3rwan/docker_elk_stack)\ncd docker_elk_stack\ndocker-compose build\n\n# run (daemon)\ndocker-compose up -d\n\n# show logs\ndocker-compose logs</code></pre></div>\n<p>Une fois les différents composants démarrés, vous devriez pouvoir accéder à l’interface Kibana (port 5601).</p>\n<p>Puis nous allons lancer un example d’application web (site HTML statique exposé par Nginx, ainsi qu’une sonde FileBeat permettant l’envoi des logs vers notre stack ELK)</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># build image\ndocker build ./webapp -t dockerelkstack_webapp\n\n# run (daemon)\ndocker run --network dockerelkstack_logging --link redis:redis -p 80:80 -d --name webapp dockerelkstack_webapp\n\n# show logs\ndocker logs webapp</code></pre></div>\n<p>Une fois notre composant démarré, vous devriez pouvoir accéder à l’application web (port 80).</p>\n<p><img src=\"/d3rwan-blog/media/elk/joliadmin.png\" alt=\"Exemple d’application web\"><em>Exemple d’application web (source: <a href=\"https://github.com/sbilly/joli-admin\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://github.com/sbilly/joli-admin</a>)</em></p>\n<p>Après avoir navigué quelques minutes, en retournant sur l’IHM de Kibana, un index *logstash *est à présent disponible.</p>\n<p><img src=\"/d3rwan-blog/media/elk/configure-pattern.png\" alt=\"Configuration pattern d&#x27;index\"><em>Kibana : écran de configuration d’un pattern d’index (ici, l’index logstash est détecté)</em></p>\n<p>Après avoir crée notre pattern d’index, nous pouvons à présent naviguer dans les logs de notre application web (onglet <em>Discover</em>), créer des visualisations (onglet <em>Visualize</em>) et des tableaux de bord (onglet <em>Dashboard</em>)</p>\n<p><img src=\"/d3rwan-blog/media/elk/response.png\" alt=\"Kibana: données brutes\"><em>Kibana: Visualisation brute des logs de notre application web</em></p>\n<p><img src=\"/d3rwan-blog/media/elk/analytics.png\" alt=\"Kibana: tableau de bord analytique\"><em>Kibana: Tableau de bord analytique</em></p>\n<p>And… voilà! Nous avons donc mis en place, en quelques minutes seulement, une stack de supervision opérationnelle.</p>","fields":{"slug":"/posts/elk-depuis-zero","tagSlugs":["/tag/monitoring/","/tag/elk/","/tag/elasticsearch/","/tag/kibana/"]},"frontmatter":{"date":"2016-09-28T12:00:00.000Z","description":"Ou comment déployer une architecture de monitoring en quelques minutes","tags":["Monitoring","ELK","Elasticsearch","Kibana"],"title":"Une stack ELK from scratch avec Docker","socialImage":"/d3rwan-blog/media/elk/logo.jpeg"}}},"pageContext":{"slug":"/posts/elk-depuis-zero"}}}
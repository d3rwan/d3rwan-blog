{"componentChunkName":"component---src-templates-post-template-js","path":"/posts/elk-from-scratch","result":{"data":{"markdownRemark":{"id":"4de23dc4-381c-53fa-9c6c-991d6f8acdad","html":"<p>Or how to deploy a complete monitoring architecture in few minutes.</p>\n<h2 id=\"monitor\" style=\"position:relative;\"><a href=\"#monitor\" aria-label=\"monitor permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Monitor.</h2>\n<p>In few years, monitoring has become an indispensable activity in the IT world. Technical or functional, whether it provides metrics, charts, or other KPIs, monitoring its system has become a must-have.</p>\n<p>In the rest of the article, we will learn how to deploy a monitoring architecture from scratch, in few minutes, thanks to Docker.</p>\n<h2 id=\"the-stack\" style=\"position:relative;\"><a href=\"#the-stack\" aria-label=\"the stack permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The stack.</h2>\n<p>First off, we will use the ELK stack, which has become in a few years a credible alternative to other monitoring solutions (Splunk, SAAS …).</p>\n<p>It is based on the following software:</p>\n<ul>\n<li><strong>E</strong> as <em>Elasticsearch</em>, search engine which provide full text search &#x26; analytics,</li>\n<li><strong>L</strong> as <em>Logstash</em>, an ETL for retrieving data from heterogeneous sources, transforming them and sending them to <em>Elasticsearch</em>,</li>\n<li><strong>K</strong> as <em>Kibana</em>, which provide an UI for exploring data, and create interactive dashboards</li>\n</ul>\n<p>But also :</p>\n<ul>\n<li><strong>R</strong> as *Redis, *an upstream broker which will serve as buffer in case of latency of the system, while avoiding excessive congestion in case of a peak,</li>\n<li><strong>C</strong> as <em>Curator</em>, a tool to manage our index</li>\n<li>**B *<em>as *Beats</em>, client-side agent to send the logs/metrics to our stack</li>\n</ul>\n<p><img src=\"/d3rwan-blog/media/elk/stack-elk.jpeg\" alt=\"The complete architecture\"><em>The complete architecture</em></p>\n<h2 id=\"deploy\" style=\"position:relative;\"><a href=\"#deploy\" aria-label=\"deploy permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Deploy.</h2>\n<p>We will use Docker containers for each stack component.</p>\n<ul>\n<li><a href=\"https://hub.docker.com/_/elasticsearch/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Elasticsearch</a> (5.1.2),</li>\n<li><a href=\"https://hub.docker.com/_/logstash/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Logstash</a> (5.1.2),</li>\n<li><a href=\"https://hub.docker.com/_/kibana/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Kibana</a> (5.1.2),</li>\n<li><a href=\"https://hub.docker.com/_/redis/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Redis</a> (3.2.6),</li>\n<li><a href=\"https://hub.docker.com/r/bobrik/curator/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Curator</a> (4.0.4)</li>\n</ul>\n<p>Services and interactions are described in a docker-compose.yml file:</p>\n<p><div id=\"gist40308415\" class=\"gist\">\n    <div class=\"gist-file\">\n      <div class=\"gist-data\">\n        <div class=\"js-gist-file-update-container js-task-list-container file-box\">\n  <div id=\"file-docker-compose-yml\" class=\"file\">\n    \n\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper data type-yaml \">\n      \n<table class=\"highlight tab-size js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip>\n      <tr>\n        <td id=\"file-docker-compose-yml-L1\" class=\"blob-num js-line-number\" data-line-number=\"1\"></td>\n        <td id=\"file-docker-compose-yml-LC1\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-ent\">version</span>: <span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>2<span class=\"pl-pds\">&quot;</span></span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L2\" class=\"blob-num js-line-number\" data-line-number=\"2\"></td>\n        <td id=\"file-docker-compose-yml-LC2\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L3\" class=\"blob-num js-line-number\" data-line-number=\"3\"></td>\n        <td id=\"file-docker-compose-yml-LC3\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-ent\">services</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L4\" class=\"blob-num js-line-number\" data-line-number=\"4\"></td>\n        <td id=\"file-docker-compose-yml-LC4\" class=\"blob-code blob-code-inner js-file-line\">  <span class=\"pl-c\"><span class=\"pl-c\">#</span> brocker</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L5\" class=\"blob-num js-line-number\" data-line-number=\"5\"></td>\n        <td id=\"file-docker-compose-yml-LC5\" class=\"blob-code blob-code-inner js-file-line\">  <span class=\"pl-ent\">redis</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L6\" class=\"blob-num js-line-number\" data-line-number=\"6\"></td>\n        <td id=\"file-docker-compose-yml-LC6\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">image</span>: <span class=\"pl-s\">redis:3.2.6</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L7\" class=\"blob-num js-line-number\" data-line-number=\"7\"></td>\n        <td id=\"file-docker-compose-yml-LC7\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">container_name</span>: <span class=\"pl-s\">redis</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L8\" class=\"blob-num js-line-number\" data-line-number=\"8\"></td>\n        <td id=\"file-docker-compose-yml-LC8\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">ports</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L9\" class=\"blob-num js-line-number\" data-line-number=\"9\"></td>\n        <td id=\"file-docker-compose-yml-LC9\" class=\"blob-code blob-code-inner js-file-line\">      - <span class=\"pl-c1\">6379:6379</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L10\" class=\"blob-num js-line-number\" data-line-number=\"10\"></td>\n        <td id=\"file-docker-compose-yml-LC10\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">volumes</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L11\" class=\"blob-num js-line-number\" data-line-number=\"11\"></td>\n        <td id=\"file-docker-compose-yml-LC11\" class=\"blob-code blob-code-inner js-file-line\">      - <span class=\"pl-s\">redis-data:/data</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L12\" class=\"blob-num js-line-number\" data-line-number=\"12\"></td>\n        <td id=\"file-docker-compose-yml-LC12\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">networks</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L13\" class=\"blob-num js-line-number\" data-line-number=\"13\"></td>\n        <td id=\"file-docker-compose-yml-LC13\" class=\"blob-code blob-code-inner js-file-line\">      - <span class=\"pl-s\">logging</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L14\" class=\"blob-num js-line-number\" data-line-number=\"14\"></td>\n        <td id=\"file-docker-compose-yml-LC14\" class=\"blob-code blob-code-inner js-file-line\">  <span class=\"pl-c\"><span class=\"pl-c\">#</span> index, search &amp; agregation</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L15\" class=\"blob-num js-line-number\" data-line-number=\"15\"></td>\n        <td id=\"file-docker-compose-yml-LC15\" class=\"blob-code blob-code-inner js-file-line\">  <span class=\"pl-ent\">elasticsearch</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L16\" class=\"blob-num js-line-number\" data-line-number=\"16\"></td>\n        <td id=\"file-docker-compose-yml-LC16\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">image</span>: <span class=\"pl-s\">elasticsearch:5.1.2</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L17\" class=\"blob-num js-line-number\" data-line-number=\"17\"></td>\n        <td id=\"file-docker-compose-yml-LC17\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">container_name</span>: <span class=\"pl-s\">elastic</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L18\" class=\"blob-num js-line-number\" data-line-number=\"18\"></td>\n        <td id=\"file-docker-compose-yml-LC18\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">environment</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L19\" class=\"blob-num js-line-number\" data-line-number=\"19\"></td>\n        <td id=\"file-docker-compose-yml-LC19\" class=\"blob-code blob-code-inner js-file-line\">      - <span class=\"pl-s\">ES_JAVA_OPTS=-Xms1g -Xmx1g</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L20\" class=\"blob-num js-line-number\" data-line-number=\"20\"></td>\n        <td id=\"file-docker-compose-yml-LC20\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">ports</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L21\" class=\"blob-num js-line-number\" data-line-number=\"21\"></td>\n        <td id=\"file-docker-compose-yml-LC21\" class=\"blob-code blob-code-inner js-file-line\">      - <span class=\"pl-c1\">9200:9200</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L22\" class=\"blob-num js-line-number\" data-line-number=\"22\"></td>\n        <td id=\"file-docker-compose-yml-LC22\" class=\"blob-code blob-code-inner js-file-line\">      - <span class=\"pl-c1\">9300:9300</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L23\" class=\"blob-num js-line-number\" data-line-number=\"23\"></td>\n        <td id=\"file-docker-compose-yml-LC23\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">volumes</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L24\" class=\"blob-num js-line-number\" data-line-number=\"24\"></td>\n        <td id=\"file-docker-compose-yml-LC24\" class=\"blob-code blob-code-inner js-file-line\">      - <span class=\"pl-s\">$PWD/elasticsearch/config/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L25\" class=\"blob-num js-line-number\" data-line-number=\"25\"></td>\n        <td id=\"file-docker-compose-yml-LC25\" class=\"blob-code blob-code-inner js-file-line\">      - <span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>es-data:/usr/share/elasticsearch/data<span class=\"pl-pds\">&quot;</span></span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L26\" class=\"blob-num js-line-number\" data-line-number=\"26\"></td>\n        <td id=\"file-docker-compose-yml-LC26\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">networks</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L27\" class=\"blob-num js-line-number\" data-line-number=\"27\"></td>\n        <td id=\"file-docker-compose-yml-LC27\" class=\"blob-code blob-code-inner js-file-line\">      - <span class=\"pl-s\">logging</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L28\" class=\"blob-num js-line-number\" data-line-number=\"28\"></td>\n        <td id=\"file-docker-compose-yml-LC28\" class=\"blob-code blob-code-inner js-file-line\">  <span class=\"pl-c\"><span class=\"pl-c\">#</span> UI</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L29\" class=\"blob-num js-line-number\" data-line-number=\"29\"></td>\n        <td id=\"file-docker-compose-yml-LC29\" class=\"blob-code blob-code-inner js-file-line\">  <span class=\"pl-ent\">kibana</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L30\" class=\"blob-num js-line-number\" data-line-number=\"30\"></td>\n        <td id=\"file-docker-compose-yml-LC30\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">image</span>: <span class=\"pl-s\">kibana:5.1.2</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L31\" class=\"blob-num js-line-number\" data-line-number=\"31\"></td>\n        <td id=\"file-docker-compose-yml-LC31\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">container_name</span>: <span class=\"pl-s\">kibana</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L32\" class=\"blob-num js-line-number\" data-line-number=\"32\"></td>\n        <td id=\"file-docker-compose-yml-LC32\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">ports</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L33\" class=\"blob-num js-line-number\" data-line-number=\"33\"></td>\n        <td id=\"file-docker-compose-yml-LC33\" class=\"blob-code blob-code-inner js-file-line\">      - <span class=\"pl-c1\">5601:5601</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L34\" class=\"blob-num js-line-number\" data-line-number=\"34\"></td>\n        <td id=\"file-docker-compose-yml-LC34\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">volumes</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L35\" class=\"blob-num js-line-number\" data-line-number=\"35\"></td>\n        <td id=\"file-docker-compose-yml-LC35\" class=\"blob-code blob-code-inner js-file-line\">      - <span class=\"pl-s\">$PWD/kibana/config/kibana.yml:/etc/kibana/kibana.yml</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L36\" class=\"blob-num js-line-number\" data-line-number=\"36\"></td>\n        <td id=\"file-docker-compose-yml-LC36\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">networks</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L37\" class=\"blob-num js-line-number\" data-line-number=\"37\"></td>\n        <td id=\"file-docker-compose-yml-LC37\" class=\"blob-code blob-code-inner js-file-line\">      - <span class=\"pl-s\">logging</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L38\" class=\"blob-num js-line-number\" data-line-number=\"38\"></td>\n        <td id=\"file-docker-compose-yml-LC38\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">depends_on</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L39\" class=\"blob-num js-line-number\" data-line-number=\"39\"></td>\n        <td id=\"file-docker-compose-yml-LC39\" class=\"blob-code blob-code-inner js-file-line\">      - <span class=\"pl-s\">elasticsearch</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L40\" class=\"blob-num js-line-number\" data-line-number=\"40\"></td>\n        <td id=\"file-docker-compose-yml-LC40\" class=\"blob-code blob-code-inner js-file-line\">  <span class=\"pl-c\"><span class=\"pl-c\">#</span> indexer</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L41\" class=\"blob-num js-line-number\" data-line-number=\"41\"></td>\n        <td id=\"file-docker-compose-yml-LC41\" class=\"blob-code blob-code-inner js-file-line\">  <span class=\"pl-ent\">logstash</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L42\" class=\"blob-num js-line-number\" data-line-number=\"42\"></td>\n        <td id=\"file-docker-compose-yml-LC42\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">image</span>: <span class=\"pl-s\">logstash:5.1.2</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L43\" class=\"blob-num js-line-number\" data-line-number=\"43\"></td>\n        <td id=\"file-docker-compose-yml-LC43\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">container_name</span>: <span class=\"pl-s\">logstash</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L44\" class=\"blob-num js-line-number\" data-line-number=\"44\"></td>\n        <td id=\"file-docker-compose-yml-LC44\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">command</span>: <span class=\"pl-s\">logstash -f /config/</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L45\" class=\"blob-num js-line-number\" data-line-number=\"45\"></td>\n        <td id=\"file-docker-compose-yml-LC45\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">environment</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L46\" class=\"blob-num js-line-number\" data-line-number=\"46\"></td>\n        <td id=\"file-docker-compose-yml-LC46\" class=\"blob-code blob-code-inner js-file-line\">      - <span class=\"pl-s\">JAVA_OPTS=-Xms1g -Xmx1g</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L47\" class=\"blob-num js-line-number\" data-line-number=\"47\"></td>\n        <td id=\"file-docker-compose-yml-LC47\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">volumes</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L48\" class=\"blob-num js-line-number\" data-line-number=\"48\"></td>\n        <td id=\"file-docker-compose-yml-LC48\" class=\"blob-code blob-code-inner js-file-line\">      - <span class=\"pl-s\">$PWD/logstash/config:/config</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L49\" class=\"blob-num js-line-number\" data-line-number=\"49\"></td>\n        <td id=\"file-docker-compose-yml-LC49\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">networks</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L50\" class=\"blob-num js-line-number\" data-line-number=\"50\"></td>\n        <td id=\"file-docker-compose-yml-LC50\" class=\"blob-code blob-code-inner js-file-line\">      - <span class=\"pl-s\">logging</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L51\" class=\"blob-num js-line-number\" data-line-number=\"51\"></td>\n        <td id=\"file-docker-compose-yml-LC51\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">depends_on</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L52\" class=\"blob-num js-line-number\" data-line-number=\"52\"></td>\n        <td id=\"file-docker-compose-yml-LC52\" class=\"blob-code blob-code-inner js-file-line\">      - <span class=\"pl-s\">elasticsearch</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L53\" class=\"blob-num js-line-number\" data-line-number=\"53\"></td>\n        <td id=\"file-docker-compose-yml-LC53\" class=\"blob-code blob-code-inner js-file-line\">      - <span class=\"pl-s\">redis</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L54\" class=\"blob-num js-line-number\" data-line-number=\"54\"></td>\n        <td id=\"file-docker-compose-yml-LC54\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L55\" class=\"blob-num js-line-number\" data-line-number=\"55\"></td>\n        <td id=\"file-docker-compose-yml-LC55\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-ent\">volumes</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L56\" class=\"blob-num js-line-number\" data-line-number=\"56\"></td>\n        <td id=\"file-docker-compose-yml-LC56\" class=\"blob-code blob-code-inner js-file-line\">  <span class=\"pl-ent\">es-data</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L57\" class=\"blob-num js-line-number\" data-line-number=\"57\"></td>\n        <td id=\"file-docker-compose-yml-LC57\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">driver</span>: <span class=\"pl-s\">local</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L58\" class=\"blob-num js-line-number\" data-line-number=\"58\"></td>\n        <td id=\"file-docker-compose-yml-LC58\" class=\"blob-code blob-code-inner js-file-line\">  <span class=\"pl-ent\">redis-data</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L59\" class=\"blob-num js-line-number\" data-line-number=\"59\"></td>\n        <td id=\"file-docker-compose-yml-LC59\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">driver</span>: <span class=\"pl-s\">local</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L60\" class=\"blob-num js-line-number\" data-line-number=\"60\"></td>\n        <td id=\"file-docker-compose-yml-LC60\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L61\" class=\"blob-num js-line-number\" data-line-number=\"61\"></td>\n        <td id=\"file-docker-compose-yml-LC61\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-ent\">networks</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L62\" class=\"blob-num js-line-number\" data-line-number=\"62\"></td>\n        <td id=\"file-docker-compose-yml-LC62\" class=\"blob-code blob-code-inner js-file-line\">  <span class=\"pl-ent\">logging</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-docker-compose-yml-L63\" class=\"blob-num js-line-number\" data-line-number=\"63\"></td>\n        <td id=\"file-docker-compose-yml-LC63\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-ent\">driver</span>: <span class=\"pl-s\">bridge</span></td>\n      </tr>\n</table>\n\n\n  </div>\n\n  </div>\n</div>\n\n      </div>\n      <div class=\"gist-meta\">\n        <a href=\"https://gist.github.com/d3rwan/66311cf71c8398aae0be32e47f270bab/raw/82a27cb75de0e72f2f67e1a2d72a94d7b7317678/docker-compose.yml\" style=\"float:right\">view raw</a>\n        <a href=\"https://gist.github.com/d3rwan/66311cf71c8398aae0be32e47f270bab#file-docker-compose-yml\">docker-compose.yml</a>\n        hosted with &#10084; by <a href=\"https://github.com\">GitHub</a>\n      </div>\n    </div>\n</div></p>\n<p>A viable configuration is also available on my github account : <a href=\"https://github.com/d3rwan/docker_elk_stack\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">docker<em>elk</em>stack</a>.</p>\n<h2 id=\"hello-world\" style=\"position:relative;\"><a href=\"#hello-world\" aria-label=\"hello world permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Hello, world.</h2>\n<p>Based on this repository, we will deploy a functional stack:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># clone repo &amp; build images\ngit clone [https://github.com/d3rwan/docker_elk_stack](https://github.com/d3rwan/docker_elk_stack)\ncd docker_elk_stack\ndocker-compose build\n\n# run (daemon)\ndocker-compose up -d\n\n# show logs\ndocker-compose logs</code></pre></div>\n<p>After startup, you should be able to access Kibana (port 5601).</p>\n<p>Then, we will deploy a basic example web app (NGinx serving HTML + Filebeat agent to send log in our stack)</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># build image\ndocker build ./webapp -t dockerelkstack_webapp\n\n# run (daemon)\ndocker run --network dockerelkstack_logging --link redis:redis -p 80:80 -d --name webapp dockerelkstack_webapp\n\n# show logs\ndocker logs webapp</code></pre></div>\n<p>After startup, you should be able to access the web app (port 80).</p>\n<p><img src=\"/d3rwan-blog/media/elk/joliadmin.png\" alt=\"Example web app capture (source: [https://github.com/sbilly/joli-admin](https://github.com/sbilly/joli-admin))\"><em>Example web app capture (source: <a href=\"https://github.com/sbilly/joli-admin\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://github.com/sbilly/joli-admin</a>)</em></p>\n<p>After few minutes browsing, returning to Kibana. An index (*logstash-**) is now available.</p>\n<p><img src=\"/d3rwan-blog/media/elk/configure-pattern.png\" alt=\"Kibana: Index pattern configuration screen (here, logstash-* index is available)\"><em>Kibana: Index pattern configuration screen (here, logstash-</em> index is available)*</p>\n<p>After creating index, we can now exploring our web app logs (Discover tab), create visualizations (Visualize tab) and dashboards (Dashboard tab).</p>\n<p><img src=\"/d3rwan-blog/media/elk/response.png\" alt=\"Kibana: Exploring the raw logs\"><em>Kibana: Exploring the raw logs</em></p>\n<p><img src=\"/d3rwan-blog/media/elk/analytics.png\" alt=\"Kibana: Analytic dashboard\"><em>Kibana: Analytic dashboard</em></p>\n<p>And… voilà! In just few minutes, we set up, an operational monitoring stack.</p>","fields":{"slug":"/posts/elk-from-scratch","tagSlugs":["/tag/monitoring/","/tag/elk/","/tag/elasticsearch/","/tag/kibana/"]},"frontmatter":{"date":"2016-09-28T12:00:00.000Z","description":"Or how to deploy a complete monitoring architecture in few minutes","tags":["Monitoring","ELK","Elasticsearch","Kibana"],"title":"An ELK stack from scratch, with Docker","socialImage":"/media/elk/response.png"}}},"pageContext":{"slug":"/posts/elk-from-scratch"}}}